generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model users {
  user_id    Int       @id @default(autoincrement())
  username   String    @db.VarChar(50)
  password   String    @db.VarChar(255)
  email      String    @unique @db.VarChar(50)
  role       Role      @default(USER)
  created_on DateTime  @default(now())
  last_login DateTime? @default(now())
}

model Matakuliah {
  id_matakuliah Int        @id @default(autoincrement())
  hematologi    Int
  kardio        Int
  respiratory   Int
  integumen     Int
  muskulo       Int
  persepsi      Int
  kritis        Int
  paliatif      Int
  biomedik      Int
  kdp           Int
  history       History[]  @relation("HistoryToMatakuliah")
  peminjam      Peminjam[] @relation("MatakuliahToPeminjam")
}

model History {
  id_history      Int               @id @default(autoincrement())
  id_barang       String
  nama_barang     String            @db.VarChar(50)
  jumlah          Int
  BarangToHistory BarangToHistory[]
  matakuliah      Matakuliah[]      @relation("HistoryToMatakuliah")
  peminjam        Peminjam[]        @relation("HistoryToPeminjam")
}

model BarangToHistory {
  A       String
  B       Int
  barangs Barang @relation(fields: [A], references: [id_barang], onDelete: Cascade)
  History History @relation(fields: [B], references: [id_history], onDelete: Cascade)

  @@unique([A, B], map: "_BarangToHistory_AB_unique")
  @@index([B], map: "_BarangToHistory_B_index")
  @@map("_BarangToHistory")
}

model Barang {
  id_barang       String            @id
  nama_barang     String            @db.VarChar(50)
  total_stock     Int
  jenis_barang    String            @db.VarChar(50)
  harga_barang    Int
  gambar_barang   String?
  BarangToHistory BarangToHistory[]
  keranjangs      Keranjang[]
  transaksiBarang TransaksiBarang[]

  @@map("barangs")
}

model Keranjang {
  id_keranjang Int        @id @default(autoincrement())
  barangId     String
  barangs      Barang    @relation(fields: [barangId], references: [id_barang])
  peminjam     Peminjam[]
  isCheckedOut String?   @default("N")

  @@map("keranjangs")
}

model Peminjam {
  id_peminjam         Int               @id @default(autoincrement())
  nama_dosen          String            @db.VarChar(50)
  nama_matakuliah     String            @db.VarChar(50)
  prasat              String            @db.VarChar(50)
  jam_praktek         String            @db.VarChar(10)
  tanggal_praktek     String?           @db.VarChar(20)
  tanggal_pengambilan DateTime          @default(now())
  keranjangId         Int
  keranjangs          Keranjang        @relation(fields: [keranjangId], references: [id_keranjang], onDelete: Cascade)
  transaksiBarang     TransaksiBarang[]
  history             History[]         @relation("HistoryToPeminjam")
  matakuliah          Matakuliah[]      @relation("MatakuliahToPeminjam")

  @@map("peminjam")
}

model TransaksiBarang {
  id_transaksi_barang Int      @id @default(autoincrement())
  barangId            String
  type                Type
  peminjamId          Int?
  barangs             Barang  @relation(fields: [barangId], references: [id_barang])
  peminjam            Peminjam? @relation(fields: [peminjamId], references: [id_peminjam], onDelete: Cascade)

  @@map("transaksiBarang")
}

enum Type {
  BarangKeluar
  BarangMasuk
  PENDING
}

enum Role {
  ADMIN
  USER
}
